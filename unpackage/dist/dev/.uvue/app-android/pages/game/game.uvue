import { ref, computed } from 'vue';
/* 行列 */
type Turn = 'white' | 'black';
type Board = (string | null)[][];
const __sfc__ = defineComponent({
    __name: 'game',
    setup(__props) {
        const __ins = getCurrentInstance()!;
        const _ctx = __ins.proxy as InstanceType<typeof __sfc__>;
        const _cache = __ins.renderCache;
        const rows = [0, 1, 2, 3, 4, 5, 6, 7];
        const cols = [0, 1, 2, 3, 4, 5, 6, 7];
        /* 尺寸 */
        const boardPx = ref<number>(320);
        function clamp(n: number, minV: number, maxV: number): number {
            if (n < minV)
                return minV;
            if (n > maxV)
                return maxV;
            return n;
        }
        function calcBoardPx(): number {
            // ✅ 关键：显式使用 GetSystemInfoResult（强类型，允许字段访问）
            const info: GetSystemInfoResult = uni.getSystemInfoSync();
            let ww: number = info.windowWidth;
            // 页面 padding：18*2=36
            let px = ww - 36;
            px = clamp(px, 240, 360);
            // 对齐到 8 的倍数
            px = px - (px % 8);
            return px;
        }
        boardPx.value = calcBoardPx();
        const cellPx = computed((): number => boardPx.value / 8);
        /* style 字符串 */
        const boardStyle = computed((): string => {
            const px = boardPx.value.toString(10) + 'px';
            return 'width:' + px + ';height:' + px + ';';
        });
        const rowStyle = computed((): string => {
            const w = boardPx.value.toString(10) + 'px';
            const h = cellPx.value.toString(10) + 'px';
            return 'width:' + w + ';height:' + h + ';';
        });
        const cellStyle = computed((): string => {
            const px = cellPx.value.toString(10) + 'px';
            return 'width:' + px + ';height:' + px + ';flex:0 0 ' + px + ';';
        });
        /* 对弈 */
        const turn = ref<Turn>('white');
        class Pos {
            r!: number;
            c!: number;
            constructor(r: number, c: number) {
                this.r = r;
                this.c = c;
            }
        }
        const selected = ref<Pos | null>(null);
        /* Unicode */
        const BR = '♜', BN = '♞', BB = '♝', BQ = '♛', BK = '♚', BP = '♟';
        const WR = '♖', WN = '♘', WB = '♗', WQ = '♕', WK = '♔', WP = '♙';
        function createInitBoard(): Board {
            return [
                [BR, BN, BB, BQ, BK, BB, BN, BR],
                [BP, BP, BP, BP, BP, BP, BP, BP],
                [null, null, null, null, null, null, null, null],
                [null, null, null, null, null, null, null, null],
                [null, null, null, null, null, null, null, null],
                [null, null, null, null, null, null, null, null],
                [WP, WP, WP, WP, WP, WP, WP, WP],
                [WR, WN, WB, WQ, WK, WB, WN, WR]
            ];
        }
        const board = ref<Board>(createInitBoard());
        function pieceAt(r: number, c: number): string {
            const p = board.value[r][c];
            return p == null ? '' : p;
        }
        function isWhitePiece(p: string): boolean {
            return p == WR || p == WN || p == WB || p == WQ || p == WK || p == WP;
        }
        function isBlackPiece(p: string): boolean {
            return p == BR || p == BN || p == BB || p == BQ || p == BK || p == BP;
        }
        function onTapCell(r: number, c: number) {
            const piece = board.value[r][c];
            if (selected.value == null) {
                if (piece == null)
                    return;
                if (turn.value == 'white' && isWhitePiece(piece))
                    selected.value = new Pos(r, c);
                else if (turn.value == 'black' && isBlackPiece(piece))
                    selected.value = new Pos(r, c);
                return;
            }
            const sr = selected.value!.r;
            const sc = selected.value!.c;
            const moving = board.value[sr][sc];
            if (moving == null) {
                selected.value = null;
                return;
            }
            if (piece != null &&
                ((turn.value == 'white' && isWhitePiece(piece)) ||
                    (turn.value == 'black' && isBlackPiece(piece)))) {
                selected.value = new Pos(r, c);
                return;
            }
            board.value[r][c] = moving;
            board.value[sr][sc] = null;
            selected.value = null;
            turn.value = (turn.value == 'white') ? 'black' : 'white';
        }
        function cellClass(r: number, c: number): string {
            let cls = ((r + c) % 2 == 1) ? 'dark' : 'light';
            if (selected.value != null && selected.value!.r == r && selected.value!.c == c) {
                cls = cls + ' selected';
            }
            return cls;
        }
        const selectedText = computed((): string => {
            if (selected.value == null)
                return '无';
            const file = String.fromCharCode(97 + selected.value!.c);
            const rank = (8 - selected.value!.r).toString(10);
            return file + rank;
        });
        const turnText = computed((): string => (turn.value == 'white' ? '白方回合' : '黑方回合'));
        function resetBoard() {
            board.value = createInitBoard();
            selected.value = null;
            turn.value = 'white';
        }
        return (): any | null => {
            return _cE("view", _uM({ class: "page" }), [
                _cE("view", _uM({ class: "head" }), [
                    _cE("text", _uM({ class: "h1" }), "Game"),
                    _cE("text", _uM({ class: "sub" }), _tD(turnText.value), 1 /* TEXT */)
                ]),
                _cE("view", _uM({ class: "boardWrap" }), [
                    _cE("view", _uM({
                        class: "board",
                        style: _nS(boardStyle.value)
                    }), [
                        _cE(Fragment, null, RenderHelpers.renderList(rows, (r, __key, __index, _cached): any => {
                            return _cE("view", _uM({
                                key: 'row_' + r,
                                class: "boardRow",
                                style: _nS(rowStyle.value)
                            }), [
                                _cE(Fragment, null, RenderHelpers.renderList(cols, (c, __key, __index, _cached): any => {
                                    return _cE("view", _uM({
                                        key: r + '_' + c,
                                        class: _nC(["cell", cellClass(r, c)]),
                                        style: _nS(cellStyle.value),
                                        onClick: () => { onTapCell(r, c); }
                                    }), [
                                        _cE("text", _uM({ class: "piece" }), _tD(pieceAt(r, c)), 1 /* TEXT */)
                                    ], 14 /* CLASS, STYLE, PROPS */, ["onClick"]);
                                }), 64 /* STABLE_FRAGMENT */)
                            ], 4 /* STYLE */);
                        }), 64 /* STABLE_FRAGMENT */)
                    ], 4 /* STYLE */)
                ]),
                _cE("view", _uM({ class: "panel" }), [
                    _cE("view", _uM({ class: "rowInfo rowFirst" }), [
                        _cE("text", _uM({ class: "label" }), "当前回合"),
                        _cE("text", _uM({ class: "value" }), _tD(turnText.value), 1 /* TEXT */)
                    ]),
                    _cE("view", _uM({ class: "rowInfo" }), [
                        _cE("text", _uM({ class: "label" }), "选中"),
                        _cE("text", _uM({ class: "value" }), _tD(selectedText.value), 1 /* TEXT */)
                    ]),
                    _cE("view", _uM({ class: "btns" }), [
                        _cE("view", _uM({
                            class: "btn",
                            onClick: resetBoard
                        }), [
                            _cE("text", _uM({ class: "btnText" }), "重置棋盘")
                        ])
                    ])
                ])
            ]);
        };
    }
});
export default __sfc__;
const GenPagesGameGameStyles = [_uM([["page", _pS(_uM([["paddingTop", 18], ["paddingRight", 18], ["paddingBottom", 18], ["paddingLeft", 18], ["display", "flex"], ["flexDirection", "column"]]))], ["head", _pS(_uM([["marginBottom", 12]]))], ["h1", _pS(_uM([["fontSize", 20], ["fontWeight", "700"]]))], ["sub", _pS(_uM([["fontSize", 12], ["opacity", 0.6], ["marginTop", 4]]))], ["boardWrap", _pS(_uM([["width", "100%"], ["display", "flex"], ["justifyContent", "center"], ["marginBottom", 14]]))], ["board", _pS(_uM([["borderTopLeftRadius", 14], ["borderTopRightRadius", 14], ["borderBottomRightRadius", 14], ["borderBottomLeftRadius", 14], ["overflow", "hidden"], ["borderTopWidth", 1], ["borderRightWidth", 1], ["borderBottomWidth", 1], ["borderLeftWidth", 1], ["borderTopStyle", "solid"], ["borderRightStyle", "solid"], ["borderBottomStyle", "solid"], ["borderLeftStyle", "solid"], ["borderTopColor", "rgba(0,0,0,0.12)"], ["borderRightColor", "rgba(0,0,0,0.12)"], ["borderBottomColor", "rgba(0,0,0,0.12)"], ["borderLeftColor", "rgba(0,0,0,0.12)"], ["boxSizing", "border-box"], ["display", "flex"], ["flexDirection", "column"]]))], ["boardRow", _pS(_uM([["display", "flex"], ["flexDirection", "row"]]))], ["cell", _pS(_uM([["display", "flex"], ["alignItems", "center"], ["justifyContent", "center"], ["boxSizing", "border-box"], ["flexShrink", 0]]))], ["light", _pS(_uM([["backgroundImage", "none"], ["backgroundColor", "#f0d9b5"]]))], ["dark", _pS(_uM([["backgroundImage", "none"], ["backgroundColor", "#b58863"]]))], ["selected", _pS(_uM([["borderTopWidth", 3], ["borderRightWidth", 3], ["borderBottomWidth", 3], ["borderLeftWidth", 3], ["borderTopStyle", "solid"], ["borderRightStyle", "solid"], ["borderBottomStyle", "solid"], ["borderLeftStyle", "solid"], ["borderTopColor", "rgba(31,111,235,0.9)"], ["borderRightColor", "rgba(31,111,235,0.9)"], ["borderBottomColor", "rgba(31,111,235,0.9)"], ["borderLeftColor", "rgba(31,111,235,0.9)"], ["boxShadow", "inset 0 0 0 1px rgba(255,255,255,0.25)"]]))], ["piece", _pS(_uM([["fontSize", 26], ["lineHeight", "26px"]]))], ["panel", _pS(_uM([["paddingTop", 14], ["paddingRight", 14], ["paddingBottom", 14], ["paddingLeft", 14], ["borderTopLeftRadius", 14], ["borderTopRightRadius", 14], ["borderBottomRightRadius", 14], ["borderBottomLeftRadius", 14], ["borderTopWidth", 1], ["borderRightWidth", 1], ["borderBottomWidth", 1], ["borderLeftWidth", 1], ["borderTopStyle", "solid"], ["borderRightStyle", "solid"], ["borderBottomStyle", "solid"], ["borderLeftStyle", "solid"], ["borderTopColor", "rgba(0,0,0,0.08)"], ["borderRightColor", "rgba(0,0,0,0.08)"], ["borderBottomColor", "rgba(0,0,0,0.08)"], ["borderLeftColor", "rgba(0,0,0,0.08)"], ["backgroundImage", "none"], ["backgroundColor", "rgba(0,0,0,0.02)"]]))], ["rowInfo", _pS(_uM([["display", "flex"], ["alignItems", "center"], ["justifyContent", "space-between"], ["paddingTop", 8], ["paddingRight", 0], ["paddingBottom", 8], ["paddingLeft", 0], ["borderTopWidth", 1], ["borderTopStyle", "solid"], ["borderTopColor", "rgba(0,0,0,0.06)"]]))], ["rowFirst", _pS(_uM([["borderTopWidth", "medium"], ["borderTopStyle", "none"], ["borderTopColor", "#000000"], ["paddingTop", 0]]))], ["label", _pS(_uM([["fontSize", 12], ["opacity", 0.6]]))], ["value", _pS(_uM([["fontSize", 14], ["fontWeight", "700"]]))], ["btns", _pS(_uM([["marginTop", 12]]))], ["btn", _pS(_uM([["height", 42], ["borderTopLeftRadius", 12], ["borderTopRightRadius", 12], ["borderBottomRightRadius", 12], ["borderBottomLeftRadius", 12], ["backgroundImage", "none"], ["backgroundColor", "rgba(31,111,235,0.12)"], ["borderTopWidth", 1], ["borderRightWidth", 1], ["borderBottomWidth", 1], ["borderLeftWidth", 1], ["borderTopStyle", "solid"], ["borderRightStyle", "solid"], ["borderBottomStyle", "solid"], ["borderLeftStyle", "solid"], ["borderTopColor", "rgba(31,111,235,0.25)"], ["borderRightColor", "rgba(31,111,235,0.25)"], ["borderBottomColor", "rgba(31,111,235,0.25)"], ["borderLeftColor", "rgba(31,111,235,0.25)"], ["display", "flex"], ["alignItems", "center"], ["justifyContent", "center"]]))], ["btnText", _pS(_uM([["fontSize", 14], ["fontWeight", "700"]]))]])];
//# sourceMappingURL=game.uvue.map