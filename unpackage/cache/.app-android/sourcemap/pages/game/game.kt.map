{"version":3,"sources":["pages/game/game.uvue"],"sourcesContent":["<template>\n  <view class=\"page\">\n    <view class=\"head\">\n      <text class=\"h1\">Game</text>\n      <text class=\"sub\">{{ turnText }}</text>\n    </view>\n\n    <view class=\"boardWrap\">\n      <view class=\"board\" :style=\"boardStyle\">\n        <view v-for=\"r in rows\" :key=\"'row_' + r\" class=\"boardRow\" :style=\"rowStyle\">\n          <view\n            v-for=\"c in cols\"\n            :key=\"r + '_' + c\"\n            class=\"cell\"\n            :class=\"cellClass(r, c)\"\n            :style=\"cellStyle\"\n            @tap=\"onTapCell(r, c)\"\n          >\n            <text class=\"piece\">{{ pieceAt(r, c) }}</text>\n          </view>\n        </view>\n      </view>\n    </view>\n\n    <view class=\"panel\">\n      <view class=\"rowInfo rowFirst\">\n        <text class=\"label\">当前回合</text>\n        <text class=\"value\">{{ turnText }}</text>\n      </view>\n\n      <view class=\"rowInfo\">\n        <text class=\"label\">选中</text>\n        <text class=\"value\">{{ selectedText }}</text>\n      </view>\n\n      <view class=\"btns\">\n        <view class=\"btn\" @tap=\"resetBoard\">\n          <text class=\"btnText\">重置棋盘</text>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup lang=\"uts\">\nimport { ref, computed } from 'vue'\n\n/* 行列 */\nconst rows = [0,1,2,3,4,5,6,7]\nconst cols = [0,1,2,3,4,5,6,7]\n\n/* 尺寸 */\nconst boardPx = ref<number>(320)\n\nfunction clamp(n: number, minV: number, maxV: number): number {\n  if (n < minV) return minV\n  if (n > maxV) return maxV\n  return n\n}\n\nfunction calcBoardPx(): number {\n  // ✅ 关键：显式使用 GetSystemInfoResult（强类型，允许字段访问）\n  const info: GetSystemInfoResult = uni.getSystemInfoSync()\n  let ww: number = info.windowWidth\n\n  // 页面 padding：18*2=36\n  let px = ww - 36\n  px = clamp(px, 240, 360)\n\n  // 对齐到 8 的倍数\n  px = px - (px % 8)\n  return px\n}\n\nboardPx.value = calcBoardPx()\n\nconst cellPx = computed((): number => boardPx.value / 8)\n\n/* style 字符串 */\nconst boardStyle = computed((): string => {\n  const px = boardPx.value.toString() + 'px'\n  return 'width:' + px + ';height:' + px + ';'\n})\n\nconst rowStyle = computed((): string => {\n  const w = boardPx.value.toString() + 'px'\n  const h = cellPx.value.toString() + 'px'\n  return 'width:' + w + ';height:' + h + ';'\n})\n\nconst cellStyle = computed((): string => {\n  const px = cellPx.value.toString() + 'px'\n  return 'width:' + px + ';height:' + px + ';flex:0 0 ' + px + ';'\n})\n\n/* 对弈 */\ntype Turn = 'white' | 'black'\nconst turn = ref<Turn>('white')\n\nclass Pos {\n  r: number\n  c: number\n  constructor(r: number, c: number) {\n    this.r = r\n    this.c = c\n  }\n}\nconst selected = ref<Pos | null>(null)\n\n/* Unicode */\nconst BR = '♜', BN = '♞', BB = '♝', BQ = '♛', BK = '♚', BP = '♟'\nconst WR = '♖', WN = '♘', WB = '♗', WQ = '♕', WK = '♔', WP = '♙'\n\ntype Board = (string | null)[][]\nfunction createInitBoard(): Board {\n  return [\n    [BR, BN, BB, BQ, BK, BB, BN, BR],\n    [BP, BP, BP, BP, BP, BP, BP, BP],\n    [null, null, null, null, null, null, null, null],\n    [null, null, null, null, null, null, null, null],\n    [null, null, null, null, null, null, null, null],\n    [null, null, null, null, null, null, null, null],\n    [WP, WP, WP, WP, WP, WP, WP, WP],\n    [WR, WN, WB, WQ, WK, WB, WN, WR]\n  ]\n}\nconst board = ref<Board>(createInitBoard())\n\nfunction pieceAt(r: number, c: number): string {\n  const p = board.value[r][c]\n  return p == null ? '' : p\n}\n\nfunction isWhitePiece(p: string): boolean {\n  return p == WR || p == WN || p == WB || p == WQ || p == WK || p == WP\n}\nfunction isBlackPiece(p: string): boolean {\n  return p == BR || p == BN || p == BB || p == BQ || p == BK || p == BP\n}\n\nfunction onTapCell(r: number, c: number) {\n  const piece = board.value[r][c]\n\n  if (selected.value == null) {\n    if (piece == null) return\n    if (turn.value == 'white' && isWhitePiece(piece)) selected.value = new Pos(r, c)\n    else if (turn.value == 'black' && isBlackPiece(piece)) selected.value = new Pos(r, c)\n    return\n  }\n\n  const sr = selected.value.r\n  const sc = selected.value.c\n  const moving = board.value[sr][sc]\n  if (moving == null) { selected.value = null; return }\n\n  if (\n    piece != null &&\n    ((turn.value == 'white' && isWhitePiece(piece)) ||\n     (turn.value == 'black' && isBlackPiece(piece)))\n  ) {\n    selected.value = new Pos(r, c)\n    return\n  }\n\n  board.value[r][c] = moving\n  board.value[sr][sc] = null\n  selected.value = null\n  turn.value = (turn.value == 'white') ? 'black' : 'white'\n}\n\nfunction cellClass(r: number, c: number): string {\n  let cls = ((r + c) % 2 == 1) ? 'dark' : 'light'\n  if (selected.value != null && selected.value.r == r && selected.value.c == c) {\n    cls = cls + ' selected'\n  }\n  return cls\n}\n\nconst selectedText = computed((): string => {\n  if (selected.value == null) return '无'\n  const file = String.fromCharCode(97 + selected.value.c)\n  const rank = (8 - selected.value.r).toString()\n  return file + rank\n})\n\nconst turnText = computed((): string => (turn.value == 'white' ? '白方回合' : '黑方回合'))\n\nfunction resetBoard() {\n  board.value = createInitBoard()\n  selected.value = null\n  turn.value = 'white'\n}\n</script>\n\n<style >.page {\n  padding: 18px;\n  display: flex;\n  flex-direction: column;\n}\n\n.head {\n  margin-bottom: 12px;\n}\n\n.h1 {\n  font-size: 20px;\n  font-weight: 700;\n}\n\n.sub {\n  font-size: 12px;\n  opacity: 0.6;\n  margin-top: 4px;\n}\n\n.boardWrap {\n  width: 100%;\n  display: flex;\n  justify-content: center;\n  margin-bottom: 14px;\n}\n\n/* 棋盘尺寸由 uvue 动态注入 */\n.board {\n  border-radius: 14px;\n  overflow: hidden;\n  border: 1px solid rgba(0,0,0,0.12);\n  box-sizing: border-box;\n  display: flex;\n  flex-direction: column;\n}\n\n.boardRow {\n  display: flex;\n  flex-direction: row;\n}\n\n.cell {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-sizing: border-box;\n  flex-shrink: 0;\n}\n\n.light { background: #f0d9b5; }\n.dark  { background: #b58863; }\n\n.selected {\n  border: 3px solid rgba(31,111,235,0.9);\n  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.25);\n}\n\n.piece {\n  font-size: 26px;\n  line-height: 26px;\n}\n\n.panel {\n  padding: 14px;\n  border-radius: 14px;\n  border: 1px solid rgba(0,0,0,0.08);\n  background: rgba(0,0,0,0.02);\n}\n\n.rowInfo {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 8px 0;\n  border-top: 1px solid rgba(0,0,0,0.06);\n}\n\n.rowFirst {\n  border-top: none;\n  padding-top: 0;\n}\n\n.label {\n  font-size: 12px;\n  opacity: 0.6;\n}\n\n.value {\n  font-size: 14px;\n  font-weight: 700;\n}\n\n.btns {\n  margin-top: 12px;\n}\n\n.btn {\n  height: 42px;\n  border-radius: 12px;\n  background: rgba(31,111,235,0.12);\n  border: 1px solid rgba(31,111,235,0.25);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.btnText {\n  font-size: 14px;\n  font-weight: 700;\n}\n</style>\n"],"names":[],"mappings":"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"}